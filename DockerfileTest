FROM golang:1.24 AS build
ENV BIN_FILE=/app/anti_bruteforce-tests

WORKDIR /app
COPY . .

RUN CGO_ENABLED=0 go test -c -o ${BIN_FILE} -tags=integration ./tests/*.go


FROM alpine:latest
ENV BIN_FILE=/app/anti_bruteforce-tests

COPY --from=build ${BIN_FILE} ${BIN_FILE}

CMD ["${BIN_FILE}"]